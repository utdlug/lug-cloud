# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5)

# The loopback network interface
auto lo
iface lo inet loopback

# Actual interface
auto eth0
iface eth0 inet dhcp

# Virtual interface for br-vlan
auto eth0:1
iface eth0:1 inet manual

# VXLAN interfaces
auto vxlan-mgmt
iface vxlan-mgmt inet manual
	pre-up ip link add vxlan-mgmt type vxlan id 10 group 239.0.0.10 dev eth0 || true
	up ip link set vxlan-mgmt up
	down ip link set vxlan-mgmt down
	post-down ip link del vxlan-mgmt || true

auto vxlan-vxlan
iface vxlan-vxlan inet manual
	pre-up ip link add vxlan-vxlan type vxlan id 20 group 239.0.0.20 dev eth0 || true
	up ip link set vxlan-vxlan up
	down ip link set vxlan-vxlan down
	post-down ip link del vxlan-vxlan || true

auto vxlan-storage
iface vxlan-storage inet manual
	pre-up ip link add vxlan-storage type vxlan id 30 group 239.0.0.30 dev eth0 || true
	up ip link set vxlan-storage up
	down ip link set vxlan-storage down
	post-down ip link del vxlan-storage || true

# Openstack Bridges
auto br-mgmt
iface br-mgmt inet static
	bridge_stp off
	bridge_waitport 0
	bridge_fd 0
	bridge_ports vxlan-mgmt
	address 172.16.10.{{ ansible_default_ipv4.address.split('.')[-1] }}
	netmask 255.255.255.0
	
auto br-vxlan
iface br-vxlan inet static
	bridge_stp off
	bridge_waitport 0
	bridge_fd 0
	bridge_ports vxlan-vxlan
	address 172.16.20.{{ ansible_default_ipv4.address.split('.')[-1] }}
	netmask 255.255.255.0

auto br-storage
iface br-storage inet static
	bridge_stp off
	bridge_waitport 0
	bridge_fd 0
	bridge_ports vxlan-storage
	address 172.16.30.{{ ansible_default_ipv4.address.split('.')[-1] }}
	netmask 255.255.255.0
	 
auto br-vlan
iface br-vlan inet manual
	bridge_stp off
	bridge waitport 0
	bridge_fd 0
	bridge_ports eth0:1 
